<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Client-1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>  
  </head>
  <body>
    <h1>SignalR Test</h1>
    <div id="messagesList"></div>

    <script>
      // SignalR bağlantısını başlatma
      const connectionGeneralHub = new signalR.HubConnectionBuilder()
        .withUrl("http://localhost:9006/generalHub")
        .withAutomaticReconnect()
        .configureLogging(signalR.LogLevel.Information)
        .build();

      connectionGeneralHub.serverTimeoutInMilliseconds = 2 * 60 * 1000; // 2 dakika zaman aşımı

      // Yeni sipariş alındığında çalışacak olan fonksiyon
      connectionGeneralHub.on("ReceiveNewOrder", function (order) {
        console.log("New Order Received: ", order);        
      });

      // Sipariş iptali alındığında çalışacak olan fonksiyon
      connectionGeneralHub.on("ReceiveOrderCancellation", function (order) {
        console.log("Order Cancelled: ", order);     
      });

      // Kurye konumu alındığında çalışacak olan fonksiyon
      connectionGeneralHub.on("ReceiveOrderCourierLocation", function (order) {
        console.log("Courier Location for Order ID: ", order);       
      });

      // Yeni mesaj alındığında çalışacak olan fonksiyon
      connectionGeneralHub.on("ReceiveNewMessage", function (message) {
        console.log("New Message Received: ", message);      
      });

      // SignalR bağlantısını başlat ve restoran gruba katıl
      connectionGeneralHub
        .start()
        .then(function () {
          const restaurantId = "c8940cc4-e0d2-44be-b964-986f78fb5e61"; // Restoran ID'sini buraya ekleyin
          connectionGeneralHub
            .invoke("JoinRestaurantGroup", restaurantId)
            .catch(function (err) {
              return console.error(err.toString());
            });

          const userId = "3f461003-e0c9-49c7-b187-1795be8a266b"; // User ID'sini buraya ekleyin
          connectionGeneralHub
            .invoke("JoinUserGroup", userId)
            .catch(function (err) {
              return console.error(err.toString());
            });
        })
        .catch(function (err) {
          return console.error(err.toString());
        });

      // Bağlantı kapanırsa tekrar başlatmayı dene
      connectionGeneralHub.onclose(function (error) {
        console.log("Connection closed: ", error);
        connectionGeneralHub.start().catch(function (err) {
          return console.error(err.toString());
        });
      });    
    </script>
  </body>
</html>
